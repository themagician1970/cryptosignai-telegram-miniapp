<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>CryptoSignAI - Working Version</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: transparent;
            color: white;
            font-size: 14px;
            font-weight: 600;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            min-height: 44px;
        }
        .nav-tab.active {
            background: linear-gradient(45deg, #4CAF50, #45a049);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .card h3 {
            margin-bottom: 15px;
            color: #FFD700;
        }
        .btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            margin: 10px;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            min-height: 44px;
        }
        .btn:active {
            transform: scale(0.95);
        }
        .btn-secondary {
            background: linear-gradient(45deg, #2196F3, #1976D2);
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            min-height: 60px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ CryptoSignAI</h1>
            <p>Advanced AI Trading Platform</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" data-tab="signals">‚ö° Signals</button>
            <button class="nav-tab" data-tab="charts">üìà Charts</button>
        </div>

        <!-- Signals Tab -->
        <div id="signals" class="tab-content active">
            <div class="card">
                <h3>AI Analysis</h3>
                <select id="analysis-symbol" style="width: 100%; padding: 10px; border-radius: 5px; margin-bottom: 15px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.3);">
                    <option value="bitcoin">Bitcoin (BTC)</option>
                    <option value="ethereum">Ethereum (ETH)</option>
                    <option value="binancecoin">BNB</option>
                </select>
                <button class="btn" id="analyze-btn">üîç Analyze</button>
                <div id="result">Click Analyze to test the function</div>
            </div>
        </div>

        <!-- Charts Tab -->
        <div id="charts" class="tab-content">
            <div class="card">
                <h3>üìä Professional Chart Analysis</h3>
                <div style="margin-bottom: 15px;">
                    <button class="btn" id="upload-chart-btn">üì∏ Upload Chart</button>
                    <button class="btn btn-secondary" id="live-analysis-btn">‚ö° Live Analysis</button>
                </div>
                <div id="chart-result">Click Live Analysis to test the function</div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Telegram WebApp
        let tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.MainButton.setText('üöÄ CryptoSignAI');
            tg.MainButton.show();
            console.log('‚úÖ Telegram WebApp initialized');
        } else {
            console.log('‚ö†Ô∏è Running in browser mode');
        }

        // Tab switching
        function showTab(tabName) {
            console.log('üîÑ Switching to tab:', tabName);
            
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }

        // Analyze function
        async function analyzeSymbol() {
            console.log('üîç analyzeSymbol() called');
            
            const symbol = document.getElementById('analysis-symbol').value;
            const resultDiv = document.getElementById('result');
            
            resultDiv.innerHTML = '<div class="loading"></div> Analyzing...';
            
            try {
                const response = await fetch(`/api/analyze?symbol=${symbol}`);
                const data = await response.json();
                
                console.log('Analysis result:', data);
                
                resultDiv.innerHTML = `
                    <div style="color: #4CAF50;">‚úÖ Analysis Complete!</div>
                    <div>Symbol: ${data.symbol}</div>
                    <div>Price: $${data.price}</div>
                    <div>Signal: ${data.signal}</div>
                    <div>Confidence: ${data.confidence}%</div>
                `;
                
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }
                
            } catch (error) {
                console.error('Analysis error:', error);
                resultDiv.innerHTML = `<div style="color: #f44336;">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Live analysis function
        async function generateLiveAnalysis() {
            console.log('‚ö° generateLiveAnalysis() called');
            
            const resultDiv = document.getElementById('chart-result');
            
            resultDiv.innerHTML = '<div class="loading"></div> Generating live analysis...';
            
            try {
                const response = await fetch('/api/chart-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        symbol: 'BTCUSD',
                        chartData: 'live-analysis'
                    })
                });
                const data = await response.json();
                
                console.log('Live analysis result:', data);
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="color: #4CAF50;">‚úÖ Live Analysis Complete!</div>
                        <div>Symbol: ${data.analysis.symbol}</div>
                        <div>Signal: ${data.analysis.signal}</div>
                        <div>Entry: $${data.analysis.entryPrice.toFixed(2)}</div>
                        <div>R:R Ratio: 1:${data.analysis.riskReward}</div>
                    `;
                } else {
                    resultDiv.innerHTML = '<div style="color: #FFA500;">‚ö†Ô∏è Using fallback analysis</div>';
                }
                
                if (tg?.HapticFeedback) {
                    tg.HapticFeedback.notificationOccurred('success');
                }
                
            } catch (error) {
                console.error('Live analysis error:', error);
                resultDiv.innerHTML = `<div style="color: #f44336;">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Setup event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üîß Setting up event listeners...');
            
            // Navigation tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
                
                tab.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    const tabName = this.getAttribute('data-tab');
                    showTab(tabName);
                });
            });

            // Analyze button
            const analyzeBtn = document.getElementById('analyze-btn');
            if (analyzeBtn) {
                analyzeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Analyze button clicked');
                    analyzeSymbol();
                });
                
                analyzeBtn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    console.log('Analyze button touched');
                    analyzeSymbol();
                });
            }

            // Live analysis button
            const liveAnalysisBtn = document.getElementById('live-analysis-btn');
            if (liveAnalysisBtn) {
                liveAnalysisBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Live analysis button clicked');
                    generateLiveAnalysis();
                });
                
                liveAnalysisBtn.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    console.log('Live analysis button touched');
                    generateLiveAnalysis();
                });
            }

            // Upload button
            const uploadBtn = document.getElementById('upload-chart-btn');
            if (uploadBtn) {
                uploadBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('chart-result').innerHTML = '‚úÖ Upload button works!';
                });
            }

            console.log('‚úÖ Event listeners setup complete');
        });

        console.log('üöÄ CryptoSignAI Working Version Loaded');
    </script>
</body>
</html>
